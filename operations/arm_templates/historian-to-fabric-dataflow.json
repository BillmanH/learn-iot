{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "aioInstanceName": {
      "type": "string",
      "defaultValue": "iot-ops-cluster-aio"
    },
    "customLocationName": {
      "type": "string",
      "defaultValue": "location-20501"
    },
    "location": {
      "type": "string",
      "defaultValue": "westus2"
    }
  },
  "resources": [
    {
      "type": "Microsoft.IoTOperations/instances/dataflowProfiles/dataflows",
      "apiVersion": "2024-11-01",
      "name": "[concat(parameters('aioInstanceName'), '/default/historian-to-fabric')]",
      "extendedLocation": {
        "type": "CustomLocation",
        "name": "[resourceId('Microsoft.ExtendedLocation/customLocations', parameters('customLocationName'))]"
      },
      "properties": {
        "mode": "Enabled",
        "operations": [
          {
            "operationType": "Source",
            "sourceSettings": {
              "endpointRef": "default",
              "dataSources": [
                "historian/health",
                "historian/lastvalue/#"
              ]
            }
          },
          {
            "operationType": "Destination",
            "destinationSettings": {
              "endpointRef": "fabric-endpoint",
              "dataDestination": "historian-data"
            }
          }
        ]
      }
    }
  ]
}
